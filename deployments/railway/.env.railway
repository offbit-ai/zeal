# Railway Environment Configuration for Zeal
# This file contains all environment variables needed for Railway deployment
# Copy this to Railway dashboard or use with railway vars set

# ============================================
# DATABASE CONFIGURATION
# ============================================

# Main PostgreSQL (Railway provides this automatically)
# DATABASE_URL is auto-injected by Railway PostgreSQL plugin

# TimescaleDB Configuration (from second PostgreSQL instance)
# Get these values from your TimescaleDB PostgreSQL service in Railway
TIMESCALE_HOST=your-timescale-host.railway.internal
TIMESCALE_PORT=5432
TIMESCALE_DATABASE=zeal_traces
TIMESCALE_USER=postgres
TIMESCALE_PASSWORD=your-timescale-password

# TimescaleDB Retention Policies (PostgreSQL intervals)
TIMESCALE_RETENTION_FLOW_TRACES=30 days
TIMESCALE_RETENTION_TRACE_EVENTS=7 days
TIMESCALE_RETENTION_SESSIONS=90 days

# ============================================
# REDIS CONFIGURATION
# ============================================

# Redis (Railway provides REDIS_URL automatically)
# REDIS_URL is auto-injected by Railway Redis plugin
REDIS_PASSWORD=auto-from-redis-url

# ============================================
# CRDT SERVER CONFIGURATION
# ============================================

# Public WebSocket URL (uses Railway's public domain)
NEXT_PUBLIC_CRDT_SERVER_URL=wss://${RAILWAY_PUBLIC_DOMAIN}/crdt

# Internal CRDT server URL (for server-side connections)
CRDT_INTERNAL_URL=http://crdt-server.railway.internal:8080

# CRDT Server Settings (set these on the crdt-server service)
RUST_LOG=info
CORS_ORIGIN=https://${RAILWAY_PUBLIC_DOMAIN}
MAX_CLIENTS_PER_ROOM=100
CLIENT_TIMEOUT_MINUTES=30
DISABLE_REDIS_PERSISTENCE=false

# ============================================
# APPLICATION CONFIGURATION
# ============================================

# Node Environment
NODE_ENV=production

# Application URLs
NEXT_PUBLIC_APP_URL=https://${RAILWAY_PUBLIC_DOMAIN}
NEXT_PUBLIC_API_URL=https://${RAILWAY_PUBLIC_DOMAIN}
NEXT_PUBLIC_BASE_URL=https://${RAILWAY_PUBLIC_DOMAIN}

# NextAuth Configuration
NEXTAUTH_URL=https://${RAILWAY_PUBLIC_DOMAIN}
NEXTAUTH_SECRET=generate-with-openssl-rand-base64-32

# ============================================
# FEATURE FLAGS
# ============================================

NEXT_PUBLIC_ENABLE_COLLABORATION=true
NEXT_PUBLIC_ENABLE_FLOW_TRACING=true
NEXT_PUBLIC_ENABLE_VERSION_HISTORY=true
NEXT_PUBLIC_DEBUG_CRDT=false
NEXT_PUBLIC_VERBOSE_LOGGING=false
NEXT_PUBLIC_DISABLE_CONSOLE_LOGS=true

# ============================================
# EMBED CONFIGURATION
# ============================================

NEXT_PUBLIC_EMBED_ENABLED=true
NEXT_PUBLIC_EMBED_URL=https://${RAILWAY_PUBLIC_DOMAIN}/embed
EMBED_MAX_API_KEYS_PER_WORKFLOW=10
EMBED_DEFAULT_RATE_LIMIT=1000

# ============================================
# TEMPLATE REPOSITORY
# ============================================

USE_TEMPLATE_REPOSITORY=true
AUTO_INGEST_TEMPLATES=true

# ============================================
# STORAGE CONFIGURATION
# ============================================

# Option 1: Local storage with Railway volumes
STORAGE_TYPE=local
STORAGE_PATH=/app/storage

# Option 2: S3-compatible storage (uncomment and configure)
# STORAGE_TYPE=s3
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
# AWS_S3_BUCKET=
# AWS_REGION=us-east-1

# Option 3: Cloudflare R2 (recommended for production)
# STORAGE_TYPE=r2
# R2_ACCOUNT_ID=
# R2_ACCESS_KEY_ID=
# R2_SECRET_ACCESS_KEY=
# R2_BUCKET_NAME=
# R2_PUBLIC_URL=

# Option 4: MinIO (self-hosted S3)
# STORAGE_TYPE=minio
# MINIO_ENDPOINT=
# MINIO_ACCESS_KEY=
# MINIO_SECRET_KEY=
# MINIO_BUCKET=
# MINIO_USE_SSL=true
# NEXT_PUBLIC_MINIO_URL=

# ============================================
# AI SERVICES (Optional)
# ============================================

# Embedding Configuration
EMBEDDING_VENDOR=mock
# EMBEDDING_VENDOR=openai
# EMBEDDING_API_KEY=
# EMBEDDING_MODEL=text-embedding-3-small
EMBEDDING_DIMENSIONS=1536
EMBEDDING_BATCH_SIZE=100
EMBEDDING_RATE_LIMIT_DELAY=100

# OpenRouter Configuration
# OPENROUTER_API_KEY=
# OPENROUTER_MODEL=anthropic/claude-3.5-sonnet

# Azure OpenAI (if using)
# AZURE_OPENAI_ENDPOINT=
# AZURE_OPENAI_API_VERSION=

# Google Vertex AI (if using)
# GOOGLE_REGION=
# GOOGLE_PROJECT_ID=

# ============================================
# AUTHORIZATION (Optional)
# ============================================

# Authorization Settings
ZEAL_AUTH_ENABLED=false
ZEAL_AUTH_MODE=development

# Secret key for HMAC token signing (required for SDK token generation)
ZEAL_SECRET_KEY=generate-with-openssl-rand-base64-32

# Development Mode Settings
ZEAL_DEV_USER_ID=dev-user
ZEAL_DEV_TENANT_ID=dev-tenant
ZEAL_DEV_ORG_ID=dev-org
ZEAL_DEV_ROLES=user,developer
ZEAL_DEV_ALLOW_ALL=false

# Production Mode - Identity Provider Configuration
# AUTH_JWT_ISSUER=
# AUTH_JWT_AUDIENCE=
# AUTH_JWT_JWKS_URI=
# AUTH_JWT_PUBLIC_KEY=

# Claim Mappings
AUTH_CLAIM_SUBJECT_ID=sub
AUTH_CLAIM_TENANT=tenant_id
AUTH_CLAIM_ORGANIZATION=org_id
AUTH_CLAIM_ROLES=roles
AUTH_CLAIM_PERMISSIONS=permissions

# Policy Configuration
ZEAL_AUTH_POLICIES_PATH=./auth-policies.yaml
ZEAL_AUTH_DEFAULT_EFFECT=deny

# Cache Configuration
ZEAL_AUTH_CACHE_ENABLED=true
ZEAL_AUTH_CACHE_TTL=300

# Audit Configuration
ZEAL_AUTH_AUDIT_ENABLED=false
ZEAL_AUTH_AUDIT_LEVEL=info

# Auth Database Configuration
ZEAL_AUTH_USE_WORKFLOW_DB=true
ZEAL_AUTH_SCHEMA_NAME=zeal_auth

# ============================================
# MONITORING (Optional)
# ============================================

# Datadog
# DD_API_KEY=
# DD_SITE=datadoghq.com
# DD_ENV=production
# DD_SERVICE=zeal

# New Relic
# NEW_RELIC_LICENSE_KEY=
# NEW_RELIC_APP_NAME=zeal

# Sentry
# SENTRY_DSN=
# SENTRY_ENVIRONMENT=production
# SENTRY_TRACES_SAMPLE_RATE=0.1

# ============================================
# PERFORMANCE TUNING
# ============================================

# Database Pool
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=10

# TimescaleDB Pool
TIMESCALE_POOL_MIN=5
TIMESCALE_POOL_MAX=20
TIMESCALE_STATEMENT_TIMEOUT=30000

# Worker Configuration
WORKER_THREADS=4
WORKER_TIMEOUT_MS=30000

# Cache Configuration
CACHE_ENABLED=true
CACHE_TTL_SECONDS=3600

# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# ============================================
# RAILWAY-SPECIFIC
# ============================================

# These are automatically provided by Railway:
# RAILWAY_PUBLIC_DOMAIN - Your app's public URL
# RAILWAY_PRIVATE_DOMAIN - Internal networking domain
# RAILWAY_PROJECT_ID - Project ID
# RAILWAY_ENVIRONMENT - Environment name
# RAILWAY_GIT_COMMIT_SHA - Deployment commit
# PORT - Port to bind to (usually 3000)